{% extends '../base/masterpage.html' %}
{% load i18n %}
{% load custom_tags %}

{% block body %}

    <style>
        .max-width-column {
            max-width: 100px; /* Ajusta este valor seg√∫n tus necesidades */
            overflow: hidden;
            text-overflow: ellipsis; /* Opcional: Agrega puntos suspensivos al final del contenido desbordado */
            white-space: nowrap;
        }
    </style>


<h1>{% trans "Proteins" %} ({{ biodb__name }})</h1>

    <form method="GET" action="">
        <input type="text" name="search" placeholder="Search proteins..." value="{{ request.GET.search }}">
        <input type="submit" value="Search">
    </form>
    <form method="get" action="">
        <input type="checkbox" id="high_value" name="high_value" value="H" {% if request.GET.high_value == 'H' %}checked{% endif %}>
        <label for="high_value">Show only proteins with High value (H)</label>
        <input type="hidden" name="assembly_name" value="{{ assembly_name }}">
        <input type="submit" value="Filter">
    </form>

    {% if formulas %}
        <select id="score_formula_select">
        {% for f in formulas %}
            <option value="{{ f.name }}"
            {% if f.name == formula.name %}
                selected="selected"
                    {% endif %}
            > {{ f.name }} </option>
        {% endfor %}
        </select>
        <button onclick="window.location='?scoreformula=' + $('#score_formula_select').val()">{% trans 'Change SF' %}</button>
        <br />
    {% endif %}


{% if formula  %}

    {{ formula.name }} = {% for t in formula.terms %}
    <span title="{{ t.desc }}"> {{ t.coefficient }} * {{ t.param }}</span>
    {%   if not forloop.last %} + {% endif %}
{% endfor %}

{% endif %}


<table id="proteins_table"  class="table table-striped table-sm">
    <thead>
    <tr>

  <th>{% trans "Name" %}</th>
        <th>{% trans "Description" %}</th>


        <th>{% trans "Gene" %}</th>


        {% for col in tcolumns %}
            <th title="{{ col_descriptions|dictkey:col }}">{{col|replace_char:"_, " }} </th>
        {% endfor %}
    </tr>
    </thead>
    {% for protein in proteins %}
<tr>

    <td><a href="{% url 'tpwebapp:protein' protein.id %}">
        {{protein.accession}}</a></td>
    <td>{{protein.description}}</td>

    <td class="max-width-column ">{{protein.genes|join:'<br />'}}</td>
    {% for col in tcolumns %}
        <td>{{tdata|dictkey:protein.id|dictkey:col|default:""}}<br />{%  if col != "Score" %}

        ({{ weights|dictkey:protein.id|dictkey:col|default:"0" }})

        {% endif %}
        </td>
    {% endfor %}

</tr>
    {% endfor %}
</table>


<style>
    #proteins_table td:nth-child(4) {
        font-weight: bold;
    }

</style>
{% if pagination.has_previous %}
    <a href="?page={{ pagination.previous_page_number }}{% if request.GET.high_value %}&high_value={{ request.GET.high_value }}{% endif %}">Previous</a>
{% endif %}

{% if pagination.has_next %}
    <a href="?page={{ pagination.next_page_number }}{% if request.GET.high_value %}&high_value={{ request.GET.high_value }}{% endif %}">Next</a>
{% endif %}

{% endblock %}

{% block jsloaded %}
    <script>

    </script>
{% endblock %}


{% block footer %}
{% endblock %}
