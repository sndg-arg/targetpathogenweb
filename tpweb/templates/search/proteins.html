{% extends '../base/masterpage.html' %}
{% load i18n %}
{% load custom_tags %}

<script src="https://unpkg.com/htmx.org@1.9.2"></script>
{% block body %}

    <style>
        .max-width-column {
            max-width: 100px; /* Ajusta este valor seg√∫n tus necesidades */
            overflow: hidden;
            text-overflow: ellipsis; /* Opcional: Agrega puntos suspensivos al final del contenido desbordado */
            white-space: nowrap;
        }
        .search-controls-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        }
        .formula-block {
        display: block; /* Ensures the div acts as a block */
        margin-top: 20px; /* Adds some space above the block */
        }
        .filter-form.search-and-filters {
        display: flex;
        align-items: center;
        gap: 10px; /* Adjust the gap between the search bar and checkboxes as needed */
        }

        .filter-form.checkbox-group {
        display: flex;
        gap: 10px; /* Adjust the gap between checkboxes as needed */
        }

/* Optional: Style individual checkboxes for better alignment */
        .filter-form.checkbox-group div {
            display: flex;
            align-items: center;
            gap: 5px; /* Adjust the gap between the checkbox and label as needed */
        }
            </style>


<h1>{% trans "Proteins" %} ({{ biodb__name }})</h1>

<div class="formula-block">

<div class="btn-group" role="group">
    <a href="{% url 'tpwebapp:parameterformview' assembly_name=assembly_name %}" class="btn btn-primary mr-2">Filter</a>
    <form method="POST" action="{% url 'tpwebapp:reset_filters' assembly_name %}">
        {% csrf_token %}
        <input type="submit" class="btn btn-primary" value="Reset Filters">
    </form>
</div>
<div class="formula-block">
    {% if formulas %}
        <select id="score_formula_select">
        {% for f in formulas %}
            <option value="{{ f.name }}"
            {% if f.name == formula.name %}
                selected="selected"
                    {% endif %}
            > {{ f.name }} </option>
        {% endfor %}
        </select>
        <button onclick="window.location='?scoreformula=' + $('#score_formula_select').val()">{% trans 'Change SF' %}</button>
        <br />
    {% endif %}


{% if formula  %}

    {{ formula.name }} = {% for t in formula.terms %}
    <span title="{{ t.desc }}"> {{ t.coefficient }} * {{ t.param }}</span>
    {%   if not forloop.last %} + {% endif %}
{% endfor %}

{% endif %}
</div>
</div>
<table id="proteins_table"  class="table table-striped table-sm">
    <thead>
    <tr>

  <th>{% trans "Name" %}</th>
        <th>{% trans "Description" %}</th>


        <th>{% trans "Gene" %}</th>


        {% for col in tcolumns %}
            <th title="{{ col_descriptions|dictkey:col }}">{{col|replace_char:"_, " }} </th>
        {% endfor %}
    </tr>
    </thead>
    {% for protein in proteins %}
<tr>

    <td><a href="{% url 'tpwebapp:protein' protein.id %}">
        {{protein.accession}}</a></td>
    <td>{{protein.description}}</td>

    <td class="max-width-column ">{{protein.genes|join:'<br />'}}</td>
    {% for col in tcolumns %}
        <td>{{tdata|dictkey:protein.id|dictkey:col|default:""}}<br />{%  if col != "Score" %}

        ({{ weights|dictkey:protein.id|dictkey:col|default:"0" }})

        {% endif %}
        </td>
    {% endfor %}

</tr>
    {% endfor %}
</table>


<style>
    #proteins_table td:nth-child(4) {
        font-weight: bold;
    }
    .pagination li {
        margin-right: 5px; /* Adjust the spacing as needed */
    }
    .pagination li:last-child {
        margin-right: 0; /* Remove extra spacing from the last item */
    }
</style>


<span class="current-page">
    Page {{ pagination.number }} of {{ pagination.num_pages }}.
</span>

{% with base_url=request.build_absolute_uri|slice:"?" %}
<ul class="pagination">
    {% for num in pagination.page_range %}
        {% if num == 1 %}
            <li><a href="{{ base_url }}?&page={{ num }}">{{ num }}</a></li>
            <li>...</li>
        {% elif num <= pagination.number|add:10 and num >= pagination.number|add:-10 %}
            <li><a href="{{ base_url }}?&page={{ num }}">{{ num }}</a></li>
        {% elif num == pagination.num_pages %}
            <li>...</li>
            <li><a href="{{ base_url }}?&page={{ num }}">{{ num }}</a></li>
        {% endif %}
    {% endfor %}
</ul>

{% if pagination.has_previous %}
    <a href="{{ base_url }}&page={{ pagination.previous_page_number }}">Previous</a>
{% endif %}

{% if pagination.has_next %}
    <a href="{{ base_url }}&page={{ pagination.next_page_number }}">Next</a>
{% endif %}
{% endwith %}

{% endblock %}

{% block jsloaded %}
    <script>

    </script>
{% endblock %}


{% block footer %}
{% endblock %}
